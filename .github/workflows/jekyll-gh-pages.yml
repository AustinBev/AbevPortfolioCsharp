name: Deploy Blazor WebAssembly to GitHub Pages

on:
  push:
    branches: [ master ]      # or main â€“ match your default branch
  workflow_dispatch:           # manual â€œRun workflowâ€ button

permissions:
  contents: write              # required to push to gh-pages

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
    - name: ğŸ›ï¸  Checkout source
      uses: actions/checkout@v4

    - name: ğŸ› ï¸  Setup .NET SDK
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: "8.0.x"

    - name: ğŸ“¦  Restore WASM workload
      run: dotnet workload install wasm-tools

    - name: ğŸ—ï¸  Publish Blazor app
      run: dotnet publish AbevPortfolioCsharp/AbevPortfolioCsharp.csproj -c Release -o publish

    # â”€â”€ GitHub-Pages quirks â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    - name: âœï¸  Rewrite <base href>
      uses: SteveSandersonMS/ghaction-rewrite-base-href@v1
      with:
        html_path:   publish/wwwroot/index.html
        base_href:   /${{ github.event.repository.name }}/
    - name: ğŸª„  Add 404.html for SPA routing
      run: cp publish/wwwroot/index.html publish/wwwroot/404.html
    - name: ğŸš«  Disable Jekyll
      run: touch publish/wwwroot/.nojekyll
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    - name: ğŸš€  Deploy to gh-pages
      uses: JamesIves/github-pages-deploy-action@v4
      with:
        branch: gh-pages          # target branch
        folder: publish/wwwroot   # what we just built
